<!-- Language: en-US -->
<p align="right"><b>English</b> | <a href="../../zh-CN/release-notes/1.7.1.md">简体中文</a></p>

# Chats 1.7.1 Release Notes

> Release Date: 2025-10-13 (52 commits since 1.7.0)

1.7.1 is a significant experience optimization and feature enhancement release, focusing on security auditing, send experience, tool call display, performance optimization, and numerous frontend UI/UX improvements, while also fixing several critical issues.

## Highlights

- New Security Audit Log Management: Complete login attempt records and rate limit monitoring
- New Send Button Experience: Support for multiple send modes (Send, Continue, Regenerate) with mobile adaptation
- Tool Call Display Optimization: Independent `ToolCallBlock` component with clearer parameter and result display
- Generate Information On-Demand Loading: Performance optimization, reduced initial loading time
- Chat Input Experience Enhancement: Pause button, auto-hide, icon layout optimization, fullscreen mode improvement
- Admin Dashboard Enhancement: Message content query, user usage statistics optimization, unified model icons
- Mobile Optimization: Better responsive layout and touch experience

---

## Feature Details

### 1) Security Audit Log Management

Backend adds complete security audit functionality:
- New `SecurityLogsController`: Provides query interfaces for password, SMS, and Keycloak login attempts
- Data transfer objects: `KeycloakAttemptDto`, `PasswordAttemptDto`, `SmsAttemptDto`, `SecurityLogQuery`
- Login rate limit audit: Records all login attempts (success/failure) and rate limit triggers

Frontend adds security log page:
- Path: `/admin/security-logs`
- Three independent panels: Keycloak login, password login, SMS login
- Supports timezone selection, time range filtering, IP address query
- Paginated display with status visualization (success/failure/rate limited)
- Added 1200+ lines of code for complete security event observability

### 2) Send Button Experience Upgrade

New send button component (`send-button.tsx`):
- Three send modes:
  - **Send**: Send new message
  - **Continue**: Continue unfinished conversation
  - **Regenerate**: Regenerate the last message
- Dropdown menu supports mode switching
- Mobile responsive: Touch-friendly, size optimized
- Keyboard shortcut support: `Ctrl+Enter` / `Cmd+Enter`
- Optimized disable state logic, real-time response to `sendMode` state

Supporting Hook:
- `useSendMode`: Unified send mode state and event listener management

### 3) Tool Call Display Optimization

New `ToolCallBlock` component:
- Independent tool call visualization component
- Clear display of tool name, parameters, execution results
- Supports collapse/expand for long parameters/results
- Separated from Markdown rendering to avoid confusion
- Optimized tool name display

Streaming tool call improvements:
- Ensures stop button works properly
- Clearer status indication during tool call process

### 4) Generate Information On-Demand Loading

Performance optimization to reduce initial loading pressure:
- Backend adds independent endpoints:
  - `GET /api/chats/messages/{turnId}/generate-info` (user side)
  - `GET /api/admin/messages/{turnId}/generate-info` (admin side)
  - `GET /api/shared-chats/{chatId}/turns/{turnId}/generate-info` (share page)
- Frontend component refactoring:
  - `GenerateInformationAction` supports on-demand loading
  - New cache mechanism (`generateInfoCache.ts`)
  - Fixed issue where reasoning time was always 0 after refresh
- New data transfer objects: `StepGenerateInfoDto`, `TurnGenerateInfoDto`
- Separated generate info from `TurnDto`, reducing 49 lines of redundancy

### 5) Chat Input Experience Enhancement

Multiple input box improvements:
- **Pause button**: Support pause/continue during generation
- **Auto-hide input box**: Automatically collapse during generation to save screen space
- **Icon layout optimization**:
  - Input box icons arranged in the same row
  - Shortened input box header height
  - Send button doesn't take up a separate line
  - Send button smaller with 90% opacity
- **Collapse management**: Support input box collapse state management
- **Fullscreen mode**: Tools list also shown in fullscreen mode
- **Hide upload button for non-vision models**: Hide remote image upload button for non-vision models
- **Mobile optimization**: Gallery image selection support

Scroll behavior optimization:
- No longer auto-lock to bottom after scrolling during generation

### 6) Admin Dashboard Enhancement

Message management:
- Added message content query functionality
- Optimized message list routing using `pushState`

User usage statistics:
- Unified `ModelProviderIcon` component

Model icon unification:
- Refactored `ChatIcon` to `ModelProviderIcon`, unified model icon display
- Supports model provider name display
- Used in: chat header, conversation list, admin page, usage statistics, etc.

Pagination component optimization:
- Optimized pagination display for 7 pages or less
- Renamed `Pagiation.tsx` → `Pagination.tsx` (fixed typo)

### 7) Model Management UI Optimization

Model page refactoring:
- Unified icon action buttons
- New `IconActionButton` common component
- Improved collapsible panel
- Fixed drag/drop issues and optimized mobile UI

Delete popover refactoring:
- Unified `deletePopover` component

### 8) Chat Experience Optimization

Header optimization:
- Model header UI optimization
- Chat header layout adjustment

Sidebar optimization:
- Side panel supports multiple icon display

Message display:
- Fixed edge case message display issues
- Fixed empty turn issues
- Added model tooltip to conversation/admin messages
- Added skeleton for response messages

Preset management:
- Added drag handle to `ChatPresetList`
- Fixed preset list drag jump issue
- Introduced preset reset dialog

### 9) Bug Fixes

Compilation error fixes:
- Multiple FE compilation error fixes
- Fixed compile errors

Functionality fixes:
- Fixed gpt-image-1 issue
- Fixed chat update title issue
- Fixed calendar component
- Fixed issue where reasoning time was always 0 after refresh
- Fixed mobile generate information popover
- Corrected first token latency

UI fixes:
- Fixed F12 console warning
- Fixed initialization issues
- Cleaned up console.log

### 10) Code Quality & Maintenance

Component migration:
- Moved security log components to correct folder
- Deleted unused icons:
  - `IconAddress`, `IconCreditCard`, `IconEraser`, `IconError`
  - `IconMessageCirclePlus`, `IconMessageShare`, `IconMinus`, `IconSend`

Internationalization:
- Removed `en.json`, unified to `zh-CN.json`

Build optimization:
- Removed unnecessary release webhook configuration
- Frontend scaffold uses latest version

### 11) Mobile Optimization

- User management page mobile optimization
- Added edit button to user page
- Model management page mobile UI optimization
- Send button mobile support

---

## API Changes

New endpoints:
- Security audit logs:
  - `GET /api/admin/security-logs/keycloak-attempts`
  - `GET /api/admin/security-logs/password-attempts`
  - `GET /api/admin/security-logs/sms-attempts`
- Generate information on-demand loading:
  - `GET /api/chats/messages/{turnId}/generate-info`
  - `GET /api/admin/messages/{turnId}/generate-info`
  - `GET /api/shared-chats/{chatId}/turns/{turnId}/generate-info`
- Message management:
  - `GET /api/admin/messages` added `content` query parameter

---

## Breaking Changes

No breaking changes in this version. Can be upgraded smoothly from 1.7.0.

---

## Upgrade Guide

1. Backup database (recommended)
2. Rebuild and deploy backend
3. For frontend, recommend deleting `src/FE/node_modules` and reinstalling dependencies before building
4. Login as administrator and navigate to "Settings → Security Logs" to view new features

---

## Performance Improvements

- Generate information on-demand loading reduces initial loading time
- New cache mechanism (`generateInfoCache.ts`) avoids duplicate requests
- Pagination component optimization improves performance in large dataset scenarios

---

## Known Issues

- Security audit logs require backend configuration for logging, enabled by default
- Send button shortcuts may conflict with some browser extensions; use dropdown menu to switch modes

---

## Acknowledgments

- Thanks to all users who provided feedback and suggestions!

---

If you have any questions or suggestions about this version, please submit an Issue or PR in the repository. Enjoy!
